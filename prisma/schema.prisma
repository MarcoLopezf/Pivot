generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  USER
  ADMIN
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  name         String
  role         UserRole      @default(USER)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  careerGoals  CareerGoal[]
  quizAttempts QuizAttempt[]
}

model CareerGoal {
  id          String    @id @default(uuid())
  userId      String
  targetRole  String
  currentRole String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  roadmaps    Roadmap[]

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum RoadmapItemStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum RoadmapItemType {
  THEORY
  PROJECT
}

model Roadmap {
  id        String        @id @default(uuid())
  goalId    String
  title     String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  items     RoadmapItem[]

  goal CareerGoal @relation(fields: [goalId], references: [id], onDelete: Cascade)

  @@index([goalId])
}

model RoadmapItem {
  id            String            @id @default(uuid())
  roadmapId     String
  title         String
  description   String
  order         Int
  status        RoadmapItemStatus @default(PENDING)
  type          RoadmapItemType   @default(THEORY)
  topic         String            @default("")
  difficulty    String            @default("beginner")
  submissionUrl String?

  roadmap      Roadmap       @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  quizAttempts QuizAttempt[]

  @@index([roadmapId])
}

model Question {
  id         String           @id @default(uuid())
  text       String
  tags       String[]
  difficulty String
  usageCount Int              @default(0)
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  options    QuestionOption[]
}

model QuestionOption {
  id         String  @id @default(uuid())
  text       String
  isCorrect  Boolean
  questionId String

  question Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@index([questionId])
}

model QuizAttempt {
  id            String   @id @default(uuid())
  userId        String
  roadmapItemId String
  score         Float
  passed        Boolean
  createdAt     DateTime @default(now())

  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  roadmapItem RoadmapItem @relation(fields: [roadmapItemId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([roadmapItemId])
}
